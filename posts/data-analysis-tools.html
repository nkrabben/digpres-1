<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Data Analysis Tools - NYPL Digital Preservation</title> <link rel="shortcut icon" href="/digpres/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/digpres/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=2596733842"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '2596733842', { 'anonymize_ip': true }); </script> <script src="/digpres/assets/js/vendor/lunr.min.js"></script> <script src="/digpres/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Data Analysis Tools | NYPL Digital Preservation</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Data Analysis Tools" /> <meta name="author" content="Nick Krabbenhoeft" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="This is a quick aside from my series on working with Siegfried." /> <meta property="og:description" content="This is a quick aside from my series on working with Siegfried." /> <link rel="canonical" href="https://nypl.github.io/digpres/posts/data-analysis-tools" /> <meta property="og:url" content="https://nypl.github.io/digpres/posts/data-analysis-tools" /> <meta property="og:site_name" content="NYPL Digital Preservation" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-12-30T14:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Data Analysis Tools" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nick Krabbenhoeft"},"dateModified":"2017-12-30T14:00:00+00:00","datePublished":"2017-12-30T14:00:00+00:00","description":"This is a quick aside from my series on working with Siegfried.","headline":"Data Analysis Tools","mainEntityOfPage":{"@type":"WebPage","@id":"https://nypl.github.io/digpres/posts/data-analysis-tools"},"url":"https://nypl.github.io/digpres/posts/data-analysis-tools"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/digpres/" class="site-title lh-tight"> NYPL Digital Preservation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/digpres/about/" class="nav-list-link">About the Program</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Ingest category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/docs/ingest/overview" class="nav-list-link">Ingest</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Posts category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/posts/" class="nav-list-link">Posts</a><ul class="nav-list "><li class="nav-list-item "><a href="/digpres/posts/topics" class="nav-list-link">Topics</a></li></ul></li><li class="nav-list-item"><a href="/digpres/contact/" class="nav-list-link">Contact</a></li><li class="nav-list-item"><a href="/digpres/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NYPL Digital Preservation" aria-label="Search NYPL Digital Preservation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p>This is a quick aside from my series on working with Siegfried.</p> <p>Data is useless unless without tools to analyze that data. To say anything meaningful, we need to do things like group, split, manipulate, and recombine the individual data points. A lot of larger systems have some analysis functions built in, e.g. dashboards or reports. However, when you’re not working within a system, or if that system can’t do the analysis you need, you’ll need a dedicated tool.</p> <h2 id="the-spreadsheet-options-excel-sheets-etc"> <a href="#the-spreadsheet-options-excel-sheets-etc" class="anchor-heading" aria-labelledby="the-spreadsheet-options-excel-sheets-etc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Spreadsheet Options (Excel, Sheets, etc) </h2> <p><strong>The Good:</strong> It’s installed, you know how to use it, you can see the data, it has a decent user interface</p> <p><strong>The Bad:</strong> It slows down with too much data, it transforms data without telling you, it lets you fiddle with data</p> <p>Spreadsheets can take your analysis pretty far pretty quickly thanks to their graphical user interface, and I often use them for fast analysis. Spreadsheets stop being useful when the interface gets in the way of the analysis. A couple of examples:</p> <ul> <li>You have 100 spreadsheets that you want collapsed into a single dataset. Open-copy-paste can get it done, but will take a lot of double-checking to make sure nothing was missed.</li> <li>Your barcodes are 14-digits long. Your spreadsheet program converts this to a floating-point number (3.43… * 10^13), since 32-bit integers max out at 10 digits.</li> <li>You need to add address information to 1000 rows of your spreadsheet. Writing the zip code in the first row and dragging down moves the address to Wyoming, one zip code at-a-time.</li> </ul> <p>All of these problems have workarounds, including bruteforce, cell-by-cell manipulation of data. As you do larger amounts of analysis more routinely, that potential solution becomes a problem. What’s to guarantee that someone hasn’t fixed up a “few” cells by hand?</p> <p>Data scientists advocate for <a href="https://en.wikipedia.org/wiki/Reproducibility">reproducibility</a>, the ability for someone else to get the same results using the same data. As if often the case, the most likely someone else is a future you trying to rerun the analysis in the future. The less manual fiddling that’s needed for analysis, the more reproducible it can be. That includes messing aroud with <code class="language-plaintext highlighter-rouge">Open file...</code> menus, as well as cell-by-cell fiddling.</p> <h2 id="the-scripting-options"> <a href="#the-scripting-options" class="anchor-heading" aria-labelledby="the-scripting-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Scripting Options </h2> <p>To make analysis more reproducible, the first step is to start recording every step of analysis that you do.</p> <ul> <li>Step 1: Load the data</li> <li>Step 2: Clean/manipulate the data</li> <li>Step 3: Run the analysis</li> <li>Step 4: Produce a report/dataset/etc</li> </ul> <p>This looks a bit like a computer program, but for it to be a program you need a language to express it in and software to write it in. The following are my two favorite ways of doing that.</p> <h3 id="pandas--jupyter-notebooks"> <a href="#pandas--jupyter-notebooks" class="anchor-heading" aria-labelledby="pandas--jupyter-notebooks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> pandas + Jupyter Notebooks </h3> <p><strong>The Good:</strong> You may already know Python, you can use the rest of Python alongside pandas, you can process Big Data, you can’t fiddle with data, you can draft code like writing in a notebook</p> <p><strong>The Bad:</strong> The graphing libraries are <em>okay</em>, there can be an overwhelming number of <em>right</em> ways to do something, indexes can become very complicated, notebooks can be very drafty</p> <p>Pandas and R both use a concept called a dataframe, a 2 (or more) dimensional structure that stores data in columns and rows that are named by indexes. Basically, it’s a spreadsheet. By abstracting away the graphical representation, you don’t have to think about how answers to your questions fit on the sheet.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'path/to/siegfried.csv'</span><span class="p">)</span>

<span class="c1"># How big are the files in the Siegfried report?
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">filesize</span><span class="p">.</span><span class="nb">sum</span><span class="p">())</span>

<span class="c1"># What 10 file formats have the largest average file size?
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'format'</span><span class="p">).</span><span class="n">filesize</span><span class="p">.</span><span class="n">mean</span><span class="p">().</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># What are the 5 most common file formats with a modified data in the 1980s?
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'modified'</span><span class="p">]</span><span class="o">&lt;</span><span class="s">'1990'</span><span class="p">].</span><span class="n">groupby</span><span class="p">(</span><span class="s">'format'</span><span class="p">).</span><span class="n">size</span><span class="p">().</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></code></pre></figure> <p>You can write pandas code in program you prefer, but the most common is Jupyter notebook. The examples above can be saved as Python files and run as scripts (e.g. <code class="language-plaintext highlighter-rouge">python3 analysis.py</code>), but often analysis requires exploring the data. In the last example, you might want to explore a specific year <code class="language-plaintext highlighter-rouge">df['modified']=='1990'</code> or bound your filter <code class="language-plaintext highlighter-rouge">(df['modified']&lt;'1990') &amp; df['modified']&gt;'1980'</code> while you explore. Jupyter notebooks let you edit and rerun lines of code quickly without have to rerun everything from scratch.</p> <p>Another great benefit of pandas is that you can pull use the rest of the Python ecosystem. For example, if you want to combine a large set of CSVs into a single file, you can use the glob module to find the filenames, and then read/combine/export the data with pandas.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="c1"># Find all the CSV's in a folder
</span><span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'path/to/folder/of/*.csv'</span><span class="p">))</span>

<span class="c1"># Read them into pandas and glue them together
</span><span class="n">df_from_each_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">)</span>
<span class="n">all_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_from_each_file</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Save to a new file
</span><span class="n">all_df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'one_big.csv'</span><span class="p">)</span></code></pre></figure> <h3 id="r--rstudio"> <a href="#r--rstudio" class="anchor-heading" aria-labelledby="r--rstudio"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> R + RStudio </h3> <p><strong>The Good:</strong> The tidyverse grammar is incredibly expressive, ggplot is an amazing visualization library, you develop analyses towards a finished project.</p> <p><strong>The Bad:</strong> You probably need to learn R from scratch, R can be slow</p> <p>R does not come with the full power of a general scripting language like Python. However, it’s data analysis functions can often feel much more fluid. Here’s the most common file formats from the 1980s question using the piping feature from tidyverse.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'path/to/siegfried.csv'</span><span class="p">)</span><span class="w">

</span><span class="c1"># What are the 5 most common file formats with a modified data in the 1980s?</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">modified</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'1990-01-01'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">groupby</span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">head</span><span class="p">(</span><span class="m">5</span><span class="p">)</span></code></pre></figure> <p>Personally, that is much simpler to read than the pandas version. You can even pipe results into what many consider R’s best feature, the ggplot2 graphing library.</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">(</span><span class="n">modified</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">groupby</span><span class="p">(</span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="p">)</span></code></pre></figure> <p>And now you have a line graph of files by the year of their last modified date and grouped by their file format. Pretty powerful stuff.</p> <h2 id="conclusion"> <a href="#conclusion" class="anchor-heading" aria-labelledby="conclusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusion </h2> <p>The best tool for any task is the one you can best use. If you don’t have experience with pandas or R, there are plenty of free online course, Q&amp;A communities, and colleagues in the field that can help you learn. On this blog, I’ll be presenting most of my data analysis work in R or pandas. I hope you can find these posts useful in learning or improving your own data toolset.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
