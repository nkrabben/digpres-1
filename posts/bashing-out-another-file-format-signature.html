<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Bashing out another file format signature - NYPL Digital Preservation</title> <link rel="shortcut icon" href="/digpres/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/digpres/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=2596733842"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '2596733842', { 'anonymize_ip': true }); </script> <script src="/digpres/assets/js/vendor/lunr.min.js"></script> <script src="/digpres/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Bashing out another file format signature | NYPL Digital Preservation</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Bashing out another file format signature" /> <meta name="author" content="Nick Krabbenhoeft" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="In the last post, I used some bash tools to derive a file format signature for the ACS format used to store Clippy. During that analysis, 32 of the files had an OLE format signature, 0xD0CF11E0A1B11AE1." /> <meta property="og:description" content="In the last post, I used some bash tools to derive a file format signature for the ACS format used to store Clippy. During that analysis, 32 of the files had an OLE format signature, 0xD0CF11E0A1B11AE1." /> <link rel="canonical" href="https://nypl.github.io/digpres/posts/bashing-out-another-file-format-signature" /> <meta property="og:url" content="https://nypl.github.io/digpres/posts/bashing-out-another-file-format-signature" /> <meta property="og:site_name" content="NYPL Digital Preservation" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-01-31T14:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Bashing out another file format signature" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nick Krabbenhoeft"},"dateModified":"2018-01-31T14:00:00+00:00","datePublished":"2018-01-31T14:00:00+00:00","description":"In the last post, I used some bash tools to derive a file format signature for the ACS format used to store Clippy. During that analysis, 32 of the files had an OLE format signature, 0xD0CF11E0A1B11AE1.","headline":"Bashing out another file format signature","mainEntityOfPage":{"@type":"WebPage","@id":"https://nypl.github.io/digpres/posts/bashing-out-another-file-format-signature"},"url":"https://nypl.github.io/digpres/posts/bashing-out-another-file-format-signature"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/digpres/" class="site-title lh-tight"> NYPL Digital Preservation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/digpres/about/" class="nav-list-link">About the Program</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Ingest category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/docs/ingest/overview" class="nav-list-link">Ingest</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Posts category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/posts/" class="nav-list-link">Posts</a><ul class="nav-list "><li class="nav-list-item "><a href="/digpres/posts/topics" class="nav-list-link">Topics</a></li></ul></li><li class="nav-list-item"><a href="/digpres/contact/" class="nav-list-link">Contact</a></li><li class="nav-list-item"><a href="/digpres/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NYPL Digital Preservation" aria-label="Search NYPL Digital Preservation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p>In the <a href="/digpres/2018/01/30/bashing-out-a-file-format-signature.html">last post</a>, I used some bash tools to derive a file format signature for the ACS format used to store <a href="https://en.wikipedia.org/wiki/Office_Assistant">Clippy</a>. During that analysis, 32 of the files had an OLE format signature, 0xD0CF11E0A1B11AE1.</p> <p>Also known as the Compound File Binary Format, OLE was used as a structure for many different formats from software like 97-2003 Microsoft Office, SPSS, Minitab, and Caseware. It was also used to package the animations and character data used for Microsoft Agents.</p> <p>On <a href="https://msdn.microsoft.com/en-us/library/aa227515.aspx">this documentation page</a>, you can see the three formats Microsoft used for agents: ACS, ACF, and AAC. The ACS can store the entire character, but Microsoft also wanted to allow people to build websites and network applications with Agents. ACF and AAC made this easier since an application would only have to download the character data and animations it needed. On the other hand, Clippy.ACS took 6+ minutes to download over a 56k modem.</p> <p>Examples of ACF and AAC are actually difficult to find on the web. Microsoft used to host them at locations like http://agent.microsoft.com/agent2/chars/genie/genie.acf. As far as I can tell, all of these resources are now down and weren’t collected by a web archive. However, the OLE files from http://www.ponx.org/msagent/Acs/ have some promise.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Show bytes 1152-1212 from wade.acs</span>
<span class="c"># tail, print the end of the data stream</span>
<span class="c"># -c +1152, limits to starting at byte 1152</span>

<span class="c"># head -c 160, print the first 160 bytes of the tail</span>

<span class="c"># xxd show the hexcode of the bytes</span>

<span class="o">&gt;</span> <span class="nb">tail</span> <span class="nt">-c</span> +1152 wade.acs | <span class="nb">head</span> <span class="nt">-c</span> 160 | xxd

0000000: 0063 0068 0061 0072 002e 0061 0063 0066  .c.h.a.r...a.c.f
0000010: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000040: 0012 0002 00ff ffff ffff ffff ffff ffff  ................
0000050: ff00 0000 0000 0000 0000 0000 0000 0000  ................
0000060: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000070: 0000 0000 0000 0000 00e4 0300 0000 0000  ................
0000080: 0061 006e 0069 006d 0031 002e 0061 0061  .a.n.i.m.1...a.a
0000090: 0066 0000 0000 0000 0000 0000 0000 0000  .f..............</code></pre></figure> <p>This OLE file has at least one ACF file and AAF file embedded in it. The trick is extracting these files from inside the OLE file.</p> <h2 id="collect-all-the-ole-files-from-ponx"> <a href="#collect-all-the-ole-files-from-ponx" class="anchor-heading" aria-labelledby="collect-all-the-ole-files-from-ponx"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Collect all the OLE files from ponx </h2> <p>Honestly, I would probably use python for this, but it was a fun exercise to work out as a shell-scripting ‘one-liner’. There should be 33 files in there.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Make a directory to store the OLE files</span>
<span class="nb">mkdir </span>ole

<span class="c"># Find OLE files based on their first 2 bytes</span>
<span class="c"># for ...;, open a for loop</span>
<span class="c"># file in *.[aA][cC][sS], on each loop process one acs or ACS file</span>
<span class="c"># do ...;, the loop</span>
<span class="c"># bytes=$(head -c 2 $file);, store first two bytes in variable, byte</span>
<span class="c"># test $bytes != 'ë', test if first bytes are not ë, which are true ACS files</span>
<span class="c"># &amp;&amp; cp $file ole, if first two bytes are not ë, copy file to ole folder</span>
<span class="c"># done, finish loop</span>
<span class="o">&gt;</span><span class="k">for </span>file <span class="k">in</span> <span class="k">*</span>.[aA][cC][sS]<span class="p">;</span> <span class="k">do </span><span class="nv">bytes</span><span class="o">=</span><span class="si">$(</span><span class="nb">head</span> <span class="nt">-c</span> 2 <span class="nv">$file</span><span class="si">)</span><span class="p">;</span> <span class="nb">test</span> <span class="nv">$bytes</span> <span class="o">!=</span> <span class="s1">'ë'</span> <span class="o">&amp;&amp;</span> <span class="nb">cp</span> <span class="nv">$file</span> ole<span class="p">;</span> <span class="k">done</span>

<span class="c"># Check out OLE ACS files</span>
<span class="o">&gt;</span> <span class="nb">ls </span>ole</code></pre></figure> <h2 id="extract-acf-and-aac-files-from-ole"> <a href="#extract-acf-and-aac-files-from-ole" class="anchor-heading" aria-labelledby="extract-acf-and-aac-files-from-ole"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extract ACF and AAC files from OLE </h2> <p>This requires some tools that can read the OLE format. Since it is the basis of the 97-2003 Office formats, there’s already a very good Java library to manipulate the formats, <a href="https://poi.apache.org/index.html">Apache POI</a>. Even better, Ross Spencer wrote a <a href="github.com/exponential-decay/ole2-re-combiner">nice command-line tool</a> with the Java library to extract the files.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Install python java wrapper jython</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>jython

<span class="c"># Download the Apache POI library</span>
wget http://apache.mirrors.ionfish.org/poi/release/bin/poi-bin-3.17-20170915.tar.gz
<span class="nb">tar</span> <span class="nt">-xzf</span> poi-bin-3.17-20170915.tar.gz

<span class="c"># Download Ross Spencer's OLE tool</span>
git clone git@github.com:exponential-decay/ole2-re-combiner.git

<span class="c"># Extract all files from the ACS files</span>
<span class="c"># jython, run jython</span>
<span class="c"># -Dpython.path=poi-3.17/poi-3.17.jar, using the POI library</span>
<span class="c"># ole2-re-combiner/ole2recombiner.py, and Ross's Python script</span>
<span class="c"># --extract $file, extract files out of OLE</span>
<span class="k">for </span>file <span class="k">in </span>ole/<span class="k">*</span><span class="p">;</span> <span class="k">do </span>jython <span class="nt">-Dpython</span>.path<span class="o">=</span>poi-3.17/poi-3.17.jar ole2-re-combiner/ole2recombiner.py <span class="nt">--extract</span> <span class="nv">$file</span><span class="p">;</span> <span class="k">done</span></code></pre></figure> <h2 id="find-signatures-for-acf-and-aac-files"> <a href="#find-signatures-for-acf-and-aac-files" class="anchor-heading" aria-labelledby="find-signatures-for-acf-and-aac-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Find signatures for ACF and AAC files </h2> <p>The ole folder should be filled with subfolders now, each with the extracted ACF and AAC files. Follow the same process as the <a href="/digpres/2018/01/30/bashing-out-a-file-format-signature.html">post on the ACS files</a> to analyze them for magic numbers. You can use a small tweak to peak into all the subdirectories with one command.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Display first 16 bytes of each ACF file</span>
<span class="c"># ole/*/*.acf, all files in subdirectories of ole that have the acf extension</span>

<span class="o">&gt;</span> <span class="nb">head</span> <span class="nt">-c</span> 16 <span class="nt">-q</span> ole/<span class="k">*</span>/<span class="k">*</span>.acf | xxd</code></pre></figure> <p>I ended up with 0x1F000100 and 0x1E000100 for AAF and 0xC1ABCDAB for ACF, although I’m doing a little more research before submitting these to PRONOM.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
