<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Sed It and Forget It: Stream Editing and Metadata Repairs - NYPL Digital Preservation</title> <link rel="shortcut icon" href="/digpres/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/digpres/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=2596733842"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '2596733842', { 'anonymize_ip': true }); </script> <script src="/digpres/assets/js/vendor/lunr.min.js"></script> <script src="/digpres/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Sed It and Forget It: Stream Editing and Metadata Repairs | NYPL Digital Preservation</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Sed It and Forget It: Stream Editing and Metadata Repairs" /> <meta name="author" content="Nick Krabbenhoeft" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="I made a mistake prepping some metadata files the other day. I picked the wrong three-letter code for a division field for use in a spreadsheet, exported the rows of the spreadsheet to 1200 structured data files we use, and then updated those files with technical metadata. So how to repair that mistake?" /> <meta property="og:description" content="I made a mistake prepping some metadata files the other day. I picked the wrong three-letter code for a division field for use in a spreadsheet, exported the rows of the spreadsheet to 1200 structured data files we use, and then updated those files with technical metadata. So how to repair that mistake?" /> <link rel="canonical" href="https://nypl.github.io/digpres/posts/sed" /> <meta property="og:url" content="https://nypl.github.io/digpres/posts/sed" /> <meta property="og:site_name" content="NYPL Digital Preservation" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-01-30T14:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Sed It and Forget It: Stream Editing and Metadata Repairs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nick Krabbenhoeft"},"dateModified":"2019-01-30T14:00:00+00:00","datePublished":"2019-01-30T14:00:00+00:00","description":"I made a mistake prepping some metadata files the other day. I picked the wrong three-letter code for a division field for use in a spreadsheet, exported the rows of the spreadsheet to 1200 structured data files we use, and then updated those files with technical metadata. So how to repair that mistake?","headline":"Sed It and Forget It: Stream Editing and Metadata Repairs","mainEntityOfPage":{"@type":"WebPage","@id":"https://nypl.github.io/digpres/posts/sed"},"url":"https://nypl.github.io/digpres/posts/sed"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/digpres/" class="site-title lh-tight"> NYPL Digital Preservation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/digpres/about/" class="nav-list-link">About the Program</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Ingest category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/docs/ingest/overview" class="nav-list-link">Ingest</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Posts category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/digpres/posts/" class="nav-list-link">Posts</a><ul class="nav-list "><li class="nav-list-item "><a href="/digpres/posts/topics" class="nav-list-link">Topics</a></li></ul></li><li class="nav-list-item"><a href="/digpres/contact/" class="nav-list-link">Contact</a></li><li class="nav-list-item"><a href="/digpres/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NYPL Digital Preservation" aria-label="Search NYPL Digital Preservation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p>I made a mistake prepping some metadata files the other day. I picked the wrong three-letter code for a division field for use in a spreadsheet, exported the rows of the spreadsheet to 1200 structured data files we use, and then updated those files with technical metadata. So how to repair that mistake?</p> <p>Option 1: Go back to my spreadsheet, update the columns, update some dependent columns, re-export, and re-update.</p> <p>Option 2: Copy my Python script to update the technical metadata and rewrite it to update the fields with the typo.</p> <p>Option 3: Write a sed command.</p> <p>For me, the right answer was sed.</p> <h2 id="sed-the-stream-editor"> <a href="#sed-the-stream-editor" class="anchor-heading" aria-labelledby="sed-the-stream-editor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sed, the stream editor </h2> <p>Here’s the <a href="https://en.wikipedia.org/wiki/Sed">Wikipedia definition</a>: “a Unix utility that parses and transforms text, using a simple, compact programming language.” In other words, sed edits texts as it reads it, according to whatever short editing recipe you give it. For my purposes, the goal is replacing one three-letter string with another three-letter string. Let’s dig in.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Replace typo string with correct string</span>
<span class="c"># sed, edits a stream of text</span>
<span class="c"># 's/"doh/"div/g', recipe for the edit, '/' divides the parts of the recipe</span>
<span class="c">## s, substitute - replace one string with another</span>
<span class="c">## "doh, string to look for</span>
<span class="c">## "div, string to replace it with</span>
<span class="c">## g, global - perform substitution everywhere it's found, regardless of case</span>
<span class="c"># /path/to/file</span>

<span class="o">&gt;</span> <span class="nb">sed</span> <span class="s1">'s/"doh/"div/g'</span> /path/to/file</code></pre></figure> <p>That command will print out the result to your terminal, which is always a good practice as you’re building a recipe.</p> <p>That recipe performs global replacements, so defining the strings too broadly might lead to problems. For example, if I just looked for ‘doh’, I could overwrite ‘Play-doh’ and ‘Doha Airport’ as ‘Play-div’ and ‘Diva Airport’. I knew my typos always occured with a preceding ‘”’, so I include that ‘”’ in my recipe.</p> <p>Even more powerfully, sed can immediately write changes back to the original file if you add a specific flag.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Replace typo string with correct string and rewrite original file</span>
<span class="c"># sed, edits a stream of text</span>
<span class="c"># -i '', save the edited text back to the input file (for Mac)</span>
<span class="c"># 's/"doh/"div/g', recipe for the edit, '/' divides the parts of the recipe</span>
<span class="c"># /path/to/\*.json, path wildcard to call all json files in a directory </span>

<span class="o">&gt;</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s/"doh/"div/g'</span> /path/to/<span class="se">\*</span>json</code></pre></figure> <p>Once the recipe is performing as expected, the ‘-i’ flag writes the edits back to the file instead of printing it to the terminal. Using the ‘*’ pushes the automation one step further by opening all of files that match the path pattern. In one fell swoop, that’s 2400 corrections across 1200 files for me.</p> <p>The tool can do much more, but I only really know how to do text substitution with it. If you want to go really deep there’s a <a href="http://www.grymoire.com/Unix/Sed.html">grymoire</a> for it.</p> <h2 id="structured-data-is-nice-for-digitization-projects"> <a href="#structured-data-is-nice-for-digitization-projects" class="anchor-heading" aria-labelledby="structured-data-is-nice-for-digitization-projects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Structured Data is Nice for Digitization Projects </h2> <p>A side note about metadata editing tools, the format of a metadata container will often define the options for editing.</p> <p>Using spreadsheets as the primary container for metadata, would mean using spreadsheet software to perform any edits. There’s a longer post to write about comparing spreadsheets and structured data files, but the basic point is that spreadsheets offer enormously powerful tools, within a single spreadsheet. If you have more spreadsheets, you need to perform those actions in each spreadsheet.</p> <p>On the other had, structured data formats are readable by a number of bash tools and programming languages. And, those tools often have idioms for applying one change to a large number of files. For example, using more wildcards expands my reach from a single directory to multiple.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Replace typo string with correct string and rewrite original file</span>
<span class="c"># sed, edits a stream of text</span>
<span class="c"># -i '', save the edited text back to the input file (for Mac)</span>
<span class="c"># 's/"doh/"div/g', recipe for the edit, '/' divides the parts of the recipe</span>
<span class="c"># /path/to/project\*/\*.json, path wildcard to call all json files in directory that start with 'project'</span>

<span class="o">&gt;</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">''</span> <span class="s1">'s/"doh/"div/g'</span> /path/to/project<span class="se">\*</span>/<span class="se">\*</span>json</code></pre></figure> <p>And the really nice thing about structured data formats is that they are stored as text, so you can use either tools optimized for text processing like sed and tools that can parse the data structure like xml or json.</p> <h2 id="conclusions"> <a href="#conclusions" class="anchor-heading" aria-labelledby="conclusions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusions </h2> <p>If you want to see the possibilities, I’d recommend pulling together some XML files in EAD, PBCore, or whatever flavor you tend to use and try out some manipulations.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
